import{Q as I,a as O,b as G}from"./QSelect.4cd2dc06.js";import{aH as W,f as C,r as m,_ as X,w as E,a2 as S,a3 as r,a7 as g,ac as i,a8 as a,af as q,ab as Z,aI as d,aa as w,aJ as ee,aK as V,ag as oe,a9 as te,ai as ae,aL as le,aM as ne,aN as ie}from"./index.5b891057.js";import{d as ce,Q as se}from"./date.9a64349c.js";import{Q as de}from"./QTable.ba2e2247.js";import{Q as re}from"./QPage.3cb4d6cb.js";import{api as h}from"./axios.03897a5b.js";import{u as me}from"./UseNotify.5a832758.js";import{u as ue}from"./authStore.d7303527.js";import"./format.ea51ac56.js";const L=f=>(ne("data-v-eacf8776"),f=f(),ie(),f),be={class:"row items-center q-gutter-sm q-mb-md"},fe={class:"q-mb-sm flex justify-end"},_e={class:"text-blue-10 text-subtitle1"},ve={style:{"max-width":"100vw"}},ge={class:"q-mb-md"},we={class:"row q-gutter-sm"},Ve=L(()=>i("legend",{class:"text-blue-10"},"Informaci\xF3n B\xE1sica Vendedor",-1)),he={class:"q-mb-md"},ye={class:"row q-gutter-sm"},xe=L(()=>i("legend",{class:"text-blue-10"},"Informaci\xF3n B\xE1sica Comprador",-1)),pe={class:"col-grow flex row justify-between"},ke={class:"q-gutter-md"},Ce={class:"text-center"},Se={dense:"",class:"text-h5 text-blue-10 text-weight-bold"},qe={__name:"paginaVentasPage",setup(f){const T=ue(),u=C(()=>T.user),{messageWarning:y,messageSuccess:N}=me(),Q=m(!0),P=Date.now(),$=ce.formatDate(P,"YYYY-MM-DD"),n=m({nombre_cliente:"",documento_cliente:"",telefono_cliente:"",correo_cliente:""}),s=m({nombre_usuario:u.value.nombre_usuario,codigo_usuario:u.value.codigo_usuario,nombre_negocio:u.value.nombre_negocio,dirrecion_negocio:u.value.dirrecion_negocio,telefono_negocio:u.value.telefono_negocio});X(async()=>{await z()});const z=async()=>{await M()},b=m([]),M=async()=>{await h.get("medicamentos/").then(({data:e})=>{b.value=e}).catch(e=>{var t,o;y((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)})},_=e=>{e.codigo="",e.nombre_medicamento="",e.fabricante="",e.fecha_vencimiento="",e.cantidad="",e.lote="",e.stock="",e.precio="",e.total="",e.descuento="",v(e)},K=e=>{const t=e.row.nombre_medicamento;if(!t){_(e.row),x();return}const o=b.value.find(l=>l.nombre_medicamento.toLowerCase()===t.toLowerCase());o?(e.row.codigo=o.codigo,e.row.fabricante=o.fabricante,e.row.fecha_vencimiento=o.fecha_vencimiento,e.row.lote=o.lote,e.row.stock=o.stock,e.row.precio=o.precio,e.row.total="",v(e.row),U()):_(e.row)},c=m([{codigo:"",nombre_medicamento:"",fabricante:"",fecha_vencimiento:"",cantidad:"",lote:"",stock:"",precio:"",total:"",descuento:""}]),U=()=>{(c.value.length===0||c.value[c.value.length-1].nombre_medicamento!=="")&&c.value.push({codigo:"",nombre_medicamento:"",fabricante:"",fecha_vencimiento:"",cantidad:"",lote:"",stock:"",precio:"",total:"",descuento:""})},x=()=>{c.value.length>1&&c.value[0].nombre_medicamento===""&&c.value.shift()},F=e=>{const t=e.row[e.col.field];if(!t){_(e.row),x();return}const o=b.value.find(l=>l.codigo===t||l.nombre_medicamento.toLowerCase()===t.toLowerCase());o?(e.row.nombre_medicamento=o.nombre_medicamento,e.row.fabricante=o.fabricante,e.row.fecha_vencimiento=o.fecha_vencimiento,e.row.lote=o.lote,e.row.stock=o.stock,e.row.precio=o.precio,v(e.row),U()):_(e.row),x()},v=e=>{const t=parseFloat(e.cantidad)||0,o=parseFloat(e.descuento)||0,l=parseFloat(e.precio)||0;e.total=t*l-o},Y=e=>!["fabricante","fecha_vencimiento","lote","stock","precio","total"].includes(e),B=m(b.value.map(e=>e.nombre_medicamento)),j=(e,t,o)=>{if(e.length<1){o();return}t(()=>{const l=e.toLowerCase();B.value=b.value.map(k=>k.nombre_medicamento).filter(k=>k.toLowerCase().indexOf(l)>-1)})};E(c,e=>{},{deep:!0});const A=C(()=>c.value.reduce((e,t)=>e+(t.total||0),0)),D=async()=>{try{const{data:e}=await h.get(`clientes/${n.value.documento_cliente}`);console.log(e),e?n.value={...n.value,nombre_cliente:e.nombre_cliente,telefono_cliente:e.telefono_cliente,correo_cliente:e.correo_cliente}:n.value={...n.value,nombre_cliente:"",telefono_cliente:"",correo_cliente:""}}catch(e){console.error("Error fetching client data:",e)}};E(()=>n.value.documento_cliente,e=>{e&&D()});const R=async()=>{const e=JSON.stringify(n.value);try{const t=await h.post("clientes/",e);N("Cliente guardado con \xE9xito!")}catch{y("Error al guardar el cliente!")}},p=C(()=>({dataVendedor:s.value,dataCliente:n.value,itemsVentas:c.value})),H=async e=>{try{p.value.itemsVentas=p.value.itemsVentas.filter(o=>o.nombre_medicamento.trim()!=="");const t=await h.post("ventas/",p.value);c.value=[{}],n.value={nombre_cliente:"",documento_cliente:"",telefono_cliente:"",correo_cliente:""},N("Venta Realizada con \xE9xito!")}catch(t){console.error("Error saving sale:",t),y("Error al realizar la venta!")}},J=[{name:"nombre_medicamento",align:"left",label:"Medicamento",field:"nombre_medicamento",sortable:!0},{name:"cantidad",align:"right",label:"Cantidad",field:"cantidad",sortable:!0},{name:"descuento",align:"right",label:"Descuento",field:"descuento",sortable:!0},{name:"fabricante",align:"center",label:"Fabricante",field:"fabricante",sortable:!0},{name:"fecha_vencimiento",align:"center",label:"Fecha Vencimiento",field:"fecha_vencimiento",sortable:!0},{name:"lote",align:"center",label:"Lote",field:"lote",sortable:!0},{name:"stock",align:"right",label:"Stock",field:"stock",sortable:!0},{name:"precio",align:"right",label:"Precio",field:"precio",sortable:!0},{name:"total",align:"right",label:"Total",field:"total",sortable:!0}];return(e,t)=>(g(),S(re,{padding:""},{default:r(()=>[i("div",be,[a(O,null,{default:r(()=>[a(I,{label:"Ventas"}),a(I,{label:"Pagina de Ventas de Medicamentos"})]),_:1})]),i("div",null,[i("div",fe,[i("div",_e,q(Z($)),1)]),i("div",ve,[a(ee,{flat:""},{default:r(()=>[i("div",ge,[i("fieldset",we,[Ve,a(d,{modelValue:s.value.codigo_usuario,"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.codigo_usuario=o),dense:"",outlined:"",filled:"",type:"text",disable:"",readonly:"",label:"Nombre del Vendedor:",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:s.value.codigo_usuario,"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.codigo_usuario=o),dense:"",outlined:"",filled:"",type:"text",disable:"",readonly:"",label:"Codigo Vendedor:",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:s.value.nombre_negocio,"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.nombre_negocio=o),dense:"",outlined:"",filled:"",type:"text",disable:"",readonly:"",label:"Nombre Negocio:",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:s.value.dirrecion_negocio,"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.dirrecion_negocio=o),dense:"",outlined:"",filled:"",type:"text",disable:"",readonly:"",label:"Dirreci\xF3n Negocio:",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:s.value.telefono_negocio,"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.telefono_negocio=o),dense:"",outlined:"",filled:"",type:"text",disable:"",readonlylabel:"Telefono:",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"])])]),i("div",he,[i("fieldset",ye,[xe,a(d,{modelValue:n.value.documento_cliente,"onUpdate:modelValue":t[5]||(t[5]=o=>n.value.documento_cliente=o),dense:"",outlined:"",filled:"",type:"text",label:"N\xFAmero Documento",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":"",onBlur:D},null,8,["modelValue"]),a(d,{modelValue:n.value.nombre_cliente,"onUpdate:modelValue":t[6]||(t[6]=o=>n.value.nombre_cliente=o),dense:"",outlined:"",filled:"",type:"text",label:"Nombre del cliente",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:n.value.telefono_cliente,"onUpdate:modelValue":t[7]||(t[7]=o=>n.value.telefono_cliente=o),dense:"",outlined:"",filled:"",type:"text",label:"Tel\xE9fono",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(d,{modelValue:n.value.correo_cliente,"onUpdate:modelValue":t[8]||(t[8]=o=>n.value.correo_cliente=o),dense:"",outlined:"",filled:"",type:"text",label:"Correo",class:"col-xs-12 col-sm-12 col-md-2","hide-bottom-space":""},null,8,["modelValue"]),a(w,{onClick:R,color:"green","text-color":"white",dense:"",class:"q-pa-sm",label:"Guardar Cliente",style:{width:"150px"}})])])]),_:1})])]),i("div",null,[a(de,{rows:c.value,columns:J,"row-key":"codigo",flat:"",separator:"cell",class:"headerTable",dense:""},{"body-cell":r(o=>[a(se,{props:o},{default:r(()=>[o.col.field==="nombre_medicamento"?(g(),S(G,{key:0,modelValue:o.row[o.col.field],"onUpdate:modelValue":[l=>o.row[o.col.field]=l,l=>K(o)],"use-input":"","hide-dropdown-icon":"",options:B.value,onFilter:j,onKeydown:[V(l=>F(o),["enter"]),V(l=>e.moverALaSiguienteFila(o),["tab"])],clearable:""},null,8,["modelValue","onUpdate:modelValue","options","onKeydown"])):Y(o.col.field)?(g(),S(d,{key:2,modelValue:o.row[o.col.field],"onUpdate:modelValue":[l=>o.row[o.col.field]=l,l=>v(o.row)],onKeydown:[V(l=>F(o),["enter"]),V(l=>e.moverALaSiguienteFila(o),["tab"])]},null,8,["modelValue","onUpdate:modelValue","onKeydown"])):(g(),oe(ae,{key:1},[te(q(o.row[o.col.field]),1)],64))]),_:2},1032,["props"])]),top:r(()=>[i("div",pe,[i("div",ke,[a(le,{label:"Ver Solo Stock",modelValue:Q.value,"onUpdate:modelValue":t[9]||(t[9]=o=>Q.value=o)},null,8,["modelValue"]),a(w,{color:"white","text-color":"black",dense:"",class:"q-ml-sm q-pa-sm",label:"Ventas Detalladas",style:{width:"180px"}})]),i("div",null,[a(w,{"text-color":"white",dense:"",class:"bg-blue-10 q-ml-sm q-pa-sm",label:"Realizar Venta",style:{width:"180px"},onClick:H})])])]),bottom:r(()=>[a(w,{color:"green","text-color":"white",dense:"",class:"q-pa-sm",label:"Cotizar",style:{width:"100px"}})]),_:1},8,["rows"])]),i("div",Ce,[i("div",Se," Total de Ventas $ "+q(A.value),1)])]),_:1}))}};var Te=W(qe,[["__scopeId","data-v-eacf8776"]]);export{Te as default};
